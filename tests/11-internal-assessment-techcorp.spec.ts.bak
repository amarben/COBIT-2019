import { test, expect } from '@playwright/test'
import { enableCursorTracking } from './helpers/cursor-tracker'

test.describe('TechCorp Financial - Step 11: Internal Assessment', () => {
  test('conduct Q2 2024 capability assessment and identify improvement areas', async ({ page }) => {
    test.setTimeout(600000)

    console.log('\nğŸ¬ ========================================')
    console.log('   TECHCORP FINANCIAL SERVICES')
    console.log('   Step 11: Internal Assessment')
    console.log('   Q2 2024 Capability Assessment Results')
    console.log('========================================\n')

    await enableCursorTracking(page)

    await page.goto('http://localhost:5173/')
    await page.waitForLoadState('networkidle')

    console.log('ğŸ“ Navigating to Internal Assessment...\n')
    await page.locator('aside nav button').filter({ hasText: /Internal Assessment/i }).click()
    await page.waitForTimeout(2000)

    console.log('ğŸ“‹ CAPABILITY ASSESSMENT (Q2 2024)')
    console.log('   Comprehensive assessment of 40 COBIT objectives...\n')

    // Assessment Methodology
    console.log('   ğŸ“ ASSESSMENT METHODOLOGY:\n')
    console.log('   â€¢ Self-assessment using COBIT Process Assessment Model (PAM)')
    console.log('   â€¢ Validation through document review and interviews')
    console.log('   â€¢ Independent assessment facilitated by internal audit')
    console.log('   â€¢ Process capability scale: 0-5 (Incomplete â†’ Optimizing)\n')

    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    await page.waitForTimeout(2000)

    // Overall Results
    console.log('   ğŸ“Š OVERALL ASSESSMENT RESULTS:\n')

    const overallResults = [
      { metric: 'Average Current Capability', value: '2.4', description: '(between Managed and Established)' },
      { metric: 'Average Target Capability', value: '4.0', description: '(Predictable)' },
      { metric: 'Average Gap', value: '1.6 levels', description: '' },
      { metric: 'Capability Trend vs Q1', value: '+0.3', description: '(improvement from baseline)' }
    ]

    overallResults.forEach(result => {
      console.log(`   â€¢ ${result.metric}: ${result.value} ${result.description}`)
    })

    console.log('\n   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    await page.waitForTimeout(2000)

    // Domain-Level Assessment
    console.log('   ğŸ¯ DOMAIN-LEVEL ASSESSMENT:\n')

    const domainAssessment = [
      {
        domain: 'EDM (Governance)',
        avgCurrent: 2.2,
        avgTarget: 4.0,
        avgGap: 1.8,
        status: 'Foundational work in progress',
        icon: 'ğŸ›¡ï¸'
      },
      {
        domain: 'APO (Align, Plan, Organize)',
        avgCurrent: 2.4,
        avgTarget: 4.0,
        avgGap: 1.6,
        status: 'Mixed maturity, strategic processes stronger',
        icon: 'ğŸ¯'
      },
      {
        domain: 'BAI (Build, Acquire, Implement)',
        avgCurrent: 2.3,
        avgTarget: 3.8,
        avgGap: 1.5,
        status: 'Agile delivery maturing',
        icon: 'ğŸ”¨'
      },
      {
        domain: 'DSS (Deliver, Service, Support)',
        avgCurrent: 2.9,
        avgTarget: 4.2,
        avgGap: 1.3,
        status: 'Strongest domain, operational maturity',
        icon: 'âš¡'
      },
      {
        domain: 'MEA (Monitor, Evaluate, Assess)',
        avgCurrent: 2.5,
        avgTarget: 4.2,
        avgGap: 1.7,
        status: 'Monitoring in place, needs sophistication',
        icon: 'ğŸ“Š'
      }
    ]

    domainAssessment.forEach(domain => {
      console.log(`   ${domain.icon} ${domain.domain}`)
      console.log(`      Current: ${domain.avgCurrent} | Target: ${domain.avgTarget} | Gap: ${domain.avgGap} levels`)
      console.log(`      Status: ${domain.status}\n`)
    })

    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    await page.waitForTimeout(2000)

    // Priority Improvement Areas
    console.log('   ğŸš¨ PRIORITY IMPROVEMENT AREAS:\n')

    console.log('   CRITICAL GAPS (3-level gaps):\n')

    const criticalGaps = [
      {
        objective: 'EDM02: Benefits Delivery',
        current: 1,
        target: 4,
        gap: 3,
        action: 'Implement benefits realization framework',
        owner: 'Portfolio Management Office',
        timeline: 'Q3-Q4 2024',
        investment: '$500K'
      },
      {
        objective: 'APO04: Innovation',
        current: 1,
        target: 3,
        gap: 2,
        action: 'Establish innovation management process',
        owner: 'Innovation Council',
        timeline: 'Q4 2024 - Q1 2025',
        investment: '$1M'
      }
    ]

    criticalGaps.forEach((gap, idx) => {
      console.log(`   ${idx + 1}. ${gap.objective}`)
      console.log(`      Current: ${gap.current} | Target: ${gap.target} | Gap: ${gap.gap} levels`)
      console.log(`      Action: ${gap.action}`)
      console.log(`      Owner: ${gap.owner}`)
      console.log(`      Timeline: ${gap.timeline}`)
      console.log(`      Investment: ${gap.investment}\n`)
    })

    console.log('   HIGH-PRIORITY GAPS (2-level gaps - High priority):\n')

    const highPriorityGaps = [
      {
        objective: 'EDM01: Governance Framework',
        gap: 2,
        action: 'Governance maturity improvement program',
        timeline: 'Q3 2024 - Q2 2025'
      },
      {
        objective: 'APO12: Risk Management',
        gap: 2,
        action: 'Advanced risk analytics and automation',
        timeline: 'Q4 2024 - Q3 2025'
      },
      {
        objective: 'APO13: Security',
        gap: 2,
        action: 'Zero trust architecture full implementation',
        timeline: 'Ongoing through 2025'
      },
      {
        objective: 'APO07: Human Resources',
        gap: 2,
        action: 'IT competency framework and talent development',
        timeline: 'Q3-Q4 2024'
      }
    ]

    highPriorityGaps.forEach((gap, idx) => {
      console.log(`   ${idx + 1}. ${gap.objective} (Gap: ${gap.gap} levels)`)
      console.log(`      Action: ${gap.action}`)
      console.log(`      Timeline: ${gap.timeline}\n`)
    })

    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    await page.waitForTimeout(2000)

    // Capability Improvement Roadmap
    console.log('   ğŸ—ºï¸  CAPABILITY IMPROVEMENT ROADMAP:\n')

    console.log('   2024 PRIORITIES:')
    console.log('   â€¢ Q3-Q4: EDM02 (Benefits Delivery)')
    console.log('   â€¢ Q3-Q4: EDM01 (Governance Framework)')
    console.log('   â€¢ Q3-Q4: APO07 (Human Resources)')
    console.log('   â€¢ Q4: MEA01 (Performance Monitoring)\n')

    console.log('   2025 PRIORITIES:')
    console.log('   â€¢ Q1-Q3: APO12 (Risk Management)')
    console.log('   â€¢ Ongoing: APO13 (Security)')
    console.log('   â€¢ Q1-Q2: APO04 (Innovation)')
    console.log('   â€¢ Q2-Q3: BAI04 (Availability and Capacity)\n')

    console.log('   ğŸ¯ TARGET: Average capability of 3.5 by end of 2025\n')

    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    await page.waitForTimeout(2000)

    // Assessment Insights
    console.log('   ğŸ’¡ ASSESSMENT INSIGHTS AND TRENDS:\n')

    console.log('   STRENGTHS âœ…:')
    console.log('   â€¢ Strong operational service delivery (DSS domain)')
    console.log('   â€¢ Mature incident and change management')
    console.log('   â€¢ Solid security and compliance foundation')
    console.log('   â€¢ Executive support for governance\n')

    console.log('   WEAKNESSES âš ï¸:')
    console.log('   â€¢ Lack of systematic benefits realization')
    console.log('   â€¢ Innovation management immature')
    console.log('   â€¢ Resource optimization needs attention')
    console.log('   â€¢ Stakeholder engagement inconsistent\n')

    console.log('   OPPORTUNITIES ğŸ’¡:')
    console.log('   â€¢ Leverage automation to scale processes')
    console.log('   â€¢ Cloud capabilities enable rapid maturity gains')
    console.log('   â€¢ GRC platform investment showing ROI')
    console.log('   â€¢ Strong talent pipeline emerging\n')

    console.log('   THREATS âš ï¸:')
    console.log('   â€¢ Talent competition limiting capability building')
    console.log('   â€¢ Rapid technology change outpacing process maturity')
    console.log('   â€¢ Regulatory changes requiring continuous adaptation')
    console.log('   â€¢ Budget constraints limiting investment\n')

    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n')

    console.log('ğŸ’¾ SAVING ASSESSMENT RESULTS\n')

    const saveButton = page.getByRole('button', { name: /save/i })
    if (await saveButton.isVisible().catch(() => false)) {
      await saveButton.scrollIntoViewIfNeeded()
      await saveButton.click()
      await page.waitForTimeout(2000)
      console.log('   âœ… Assessment results saved')
    }

    console.log('\nğŸ‰ ========================================')
    console.log('   STEP 11 COMPLETED!')
    console.log('   ========================================')
    console.log('   âœ… Objectives Assessed: 40')
    console.log('   âœ… Average Capability: 2.4 (Managed)')
    console.log('   âœ… Target Capability: 4.0 (Predictable)')
    console.log('   âœ… Critical Gaps Identified: 2')
    console.log('   âœ… High-Priority Gaps: 4')
    console.log('   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
    console.log('   ğŸ“Š Capability Trend: +0.3 improvement')
    console.log('   ğŸ¯ 2025 Target: 3.5 average capability')
    console.log('   âœ… Ready for Performance Analysis')
    console.log('========================================\n')

    console.log('âœ¨ Demo Step 11 completed successfully!\n')
  })
})
